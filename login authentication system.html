<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simple HTML Login Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width:720px; margin:24px auto; padding:0 12px; }
    section { display:none; padding:12px; border:1px solid #ddd; border-radius:6px; margin-top:12px;}
    section.active { display:block; }
    input { padding:6px; margin:6px 0; width:100%; box-sizing:border-box; }
    .row { display:flex; gap:8px; }
    button { padding:8px 12px; }
    .msg { margin:8px 0; color:green; }
    .err { margin:8px 0; color:red; }
    nav a { margin-right:12px; cursor:pointer; color:blue; text-decoration:underline;}
  </style>
</head>
<body>
  <h1>Simple Login Demo (HTML + JS)</h1>
  <nav>
    <a id="nav-login">Login</a>
    <a id="nav-register">Register</a>
    <a id="nav-dashboard">Dashboard</a>
  </nav>

  <section id="login" class="active">
    <h2>Login</h2>
    <form id="loginForm">
      <label>Username<input name="username" required></label>
      <label>Password<input name="password" type="password" required></label>
      <button type="submit">Login</button>
    </form>
    <div id="loginError" class="err"></div>
  </section>

  <section id="register">
    <h2>Register</h2>
    <form id="registerForm">
      <label>Username<input name="username" required></label>
      <label>Password<input name="password" type="password" required></label>
      <button type="submit">Register</button>
    </form>
    <div id="regMsg" class="msg"></div>
    <div id="regError" class="err"></div>
  </section>

  <section id="dashboard">
    <h2>Dashboard</h2>
    <p id="welcome"></p>
    <button id="logoutBtn">Logout</button>
  </section>

  <script>
    // simple view switching
    const views = { login: document.getElementById('login'), register: document.getElementById('register'), dashboard: document.getElementById('dashboard') };
    function show(view) {
      Object.values(views).forEach(v => v.classList.remove('active'));
      views[view].classList.add('active');
      if (view === 'dashboard') renderDashboard();
    }
    document.getElementById('nav-login').onclick = () => show('login');
    document.getElementById('nav-register').onclick = () => show('register');
    document.getElementById('nav-dashboard').onclick = () => {
      if (sessionStorage.getItem('loggedInUser')) show('dashboard'); else show('login');
    };

    // SHA-256 hashing via Web Crypto
    async function hashPassword(password) {
      const enc = new TextEncoder().encode(password);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    // user storage: localStorage key "user:{username}" -> JSON {hash: ...}
    function userKey(username){ return `user:${username}`; }

    // Register handler
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const u = f.username.value.trim();
      const p = f.password.value;
      document.getElementById('regMsg').textContent = '';
      document.getElementById('regError').textContent = '';
      if (!u || !p) { document.getElementById('regError').textContent = 'Missing fields.'; return; }
      if (localStorage.getItem(userKey(u))) { document.getElementById('regError').textContent = 'Username taken.'; return; }
      const h = await hashPassword(p);
      localStorage.setItem(userKey(u), JSON.stringify({ hash: h }));
      document.getElementById('regMsg').textContent = 'Registered. You can now log in.';
      f.reset();
    });

    // Login handler
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const u = f.username.value.trim();
      const p = f.password.value;
      document.getElementById('loginError').textContent = '';
      const stored = localStorage.getItem(userKey(u));
      if (!stored) { document.getElementById('loginError').textContent = 'Invalid credentials.'; return; }
      const { hash } = JSON.parse(stored);
      const h = await hashPassword(p);
      if (h === hash) {
        sessionStorage.setItem('loggedInUser', u);
        f.reset();
        show('dashboard');
      } else {
        document.getElementById('loginError').textContent = 'Invalid credentials.';
      }
    });

    function renderDashboard(){
      const u = sessionStorage.getItem('loggedInUser');
      document.getElementById('welcome').textContent = u ? `Welcome, ${u}!` : 'Not logged in.';
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      sessionStorage.removeItem('loggedInUser');
      show('login');
    });

    // auto-show dashboard if already logged in
    if (sessionStorage.getItem('loggedInUser')) show('dashboard');
  </script>
</body>
</html>